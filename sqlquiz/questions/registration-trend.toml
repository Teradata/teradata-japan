# IDはユニークな文字列であれば何でも良いが、なるべくこの形式で（たぶん並べ替えやすいので）
qid = "q00000100"

# タグは文字列の配列。なしでもよい。
# タグには言語の区別はなくても良いだろう。
tags = [
  "window-function"
]


# カテゴリは必ず１つの文字列。問題の分類に用いる
# 使用できるカテゴリ一覧は別途用意する
[category]
ja = "SQL/Teradata 基礎"
en = "SQL/Teradata Basic"

[title]
ja = "登録顧客数の推移"
en = "Trend of the registered customers"

[content]
ja = """TeraShirt社の顧客リストを用いて、登録された顧客数の推移を出力してください。
<br />
結果の列は、日付とその時点での顧客数（その日に登録した人を含む）とします。
<br />
また、登録顧客数に変化があった日のみを表示し、日付で並べ替えてください。
"""
en = """
Using the customer list of the TeraShirt company, calculate the trend of the number of the registered customers.
<br />
Output columns are the date and the number of customers as of that date (includes those registerd on that day).
<br />
Display only the days when the number of customers changed, and sort them by the date.
"""


[hint]
ja = ""
en = ""


[references]
ja = ""
en = ""


# 正誤判定に関する定義
[judgement]
check_shape = false         # クエリ結果の行列数の一致を求めるか
shape = [24, 5]            # 想定されたクエリ結果のサイズ

check_type = false          # クエリ結果の列の型の一致を求めるか
types = [ "int", "int", "float" ]         # 想定されたクエリ結果の変数型

check_value = true        # 想定解との値の一致を求めるか
ordered = true            # クエリ結果の並び順が指定されているかどうか
value_from = "csv"         # 想定結果の指定方法
                           # csv      : 想定結果のCSV文字列を指定
                           # query    : 想定結果を生成するクエリを指定。動的に実行して判定する
csv = """
date,num_registered_customers
2021-05-01,19
2021-05-14,20
2021-05-16,21
2021-05-18,22
2021-05-20,23
2021-05-23,24
2021-05-28,26
2021-06-02,27
2021-06-06,28
2021-06-21,29
2021-06-25,30
2021-06-26,31
2021-07-04,32
2021-07-23,33
2021-08-13,35
2021-08-15,36
2021-08-16,37
2021-08-27,38
2021-08-30,39
2021-08-31,40
2021-09-06,41
2021-09-08,42
2021-09-24,43
2021-09-25,44
2021-10-13,45
2021-10-16,46
2021-10-28,47
2021-11-12,48
2021-11-14,49
2021-11-17,50
2021-11-22,51
2021-12-18,52
2021-12-19,53
2021-12-27,54
2021-12-28,55
2022-01-08,56
2022-01-15,57
2022-01-23,58
2022-01-26,59
2022-01-30,60
2022-02-09,61
2022-02-12,62
2022-02-21,63
2022-02-28,64
2022-03-06,65
2022-03-09,67
2022-03-11,68
2022-03-14,69
2022-03-29,70
2022-04-01,71
2022-04-02,72
2022-04-11,73
2022-04-12,74
2022-04-13,75
2022-04-21,76
2022-04-23,78
2022-04-24,80
2022-05-05,81
2022-05-13,82
2022-05-15,84
2022-05-25,85
2022-05-30,86
2022-06-03,87
2022-06-17,88
2022-06-24,89
2022-06-29,90
2022-07-01,91
2022-07-10,92
2022-07-18,93
2022-07-30,94
2022-08-01,95
2022-08-07,96
2022-08-15,97
2022-08-19,98
2022-08-26,99
2022-09-06,100
2022-09-10,101
2022-09-16,102
2022-09-20,103
2022-09-22,104
2022-10-01,106
2022-10-07,107
2022-10-09,109
2022-10-10,110
2022-10-12,111
2022-11-05,112
2022-11-08,113
2022-11-15,114
2022-11-19,115
2022-12-14,116
2022-12-18,117
2022-12-20,118
"""

query = """
WITH tmp AS (
  SELECT register_date, COUNT(*) AS n_inc
  FROM TeraShirt.customer
  GROUP BY 1
)
SELECT
  register_date AS "date",
  SUM(n_inc) OVER (
    ORDER BY register_date
    ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
  ) AS num_registered_customers
FROM
  tmp
"""

check_explain = false